<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>Potenzen & Zehnerpotenzen-Trainer</title>
<style>
  html,body{height:100%;overflow-x:hidden;}
  body{
    font-family:system-ui,Arial,sans-serif;
    background:linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align:center;margin:0;padding:20px;
  }
  h1,h2{color:#333;margin:10px 0;font-size:1.6em;font-weight:600;}
  #task,#taskAddWrapper{font-size:1.8em;margin:15px auto;word-wrap:break-word;display:block;}
  #eqMarkAdd{
    font-size:1em;margin-left:6px;color:#333;white-space:nowrap;
    vertical-align:middle;position:relative;top:-0.1em;
  }
  #result,#resultAdd{font-size:1.3em;margin:10px;font-weight:bold;}
  #score,#scoreAdd{font-size:1.1em;margin:8px;color:#333;}
  input{
    padding:10px;font-size:1.2em;width:80%;max-width:300px;text-align:center;
    border-radius:8px;border:1px solid #aaa;
  }
  input:focus{outline:none;border-color:#007bff;}
  button{
    background:#007bff;color:white;border:none;padding:10px 18px;
    margin:6px;font-size:1em;border-radius:8px;cursor:pointer;
  }
  button:hover{background:#0056b3;}
  hr{margin:30px auto;width:70%;border:1px solid #ccc;}
  .shortcutButtons{margin-top:8px;}
  .shortcutButtons button{
    background:#e3e3e3;color:#000;border:1px solid #bbb;
    padding:6px 10px;font-size:1.1em;
  }
  .shortcutButtons button:hover{background:#ccc;}
  @media(max-width:700px){
    .shortcutButtons button{padding:8px 14px;font-size:1.3em;}
  }
</style>
</head>
<body>
<h1>Potenzen â€“ Multiplikation, Division, Potenzieren</h1>
<div id="score">Aufgabe 1 von 10 â€“ Punkte: 0</div>
<div id="task">lade...</div>

<input type="text" id="answer" placeholder="Deine LÃ¶sung" autocomplete="off" spellcheck="false"><br>
<div id="supBtns1" class="shortcutButtons"></div>
<button id="checkBtn">PrÃ¼fen</button>
<button id="newBtn">Neue Aufgabe</button>
<p id="result"></p>

<hr>

<h2>Zehnerpotenzen & Gleitkommazahlen</h2>
<div id="scoreAdd">Aufgabe 1 von 10 â€“ Punkte: 0</div>
<div id="taskAddWrapper">
  <span id="taskAdd">lade...</span><span id="eqMarkAdd"> = ?</span>
</div>

<input type="text" id="answerAdd" placeholder="Deine LÃ¶sung" autocomplete="off" spellcheck="false"><br>
<div id="supBtns2" class="shortcutButtons"></div>
<button id="checkBtnAdd">PrÃ¼fen</button>
<button id="newBtnAdd">Neue Aufgabe</button>
<p id="resultAdd"></p>

<p style="font-size:0.8em;color:#555;margin-top:40px;">
Diese Seite speichert keine persÃ¶nlichen Daten und lÃ¤uft vollstÃ¤ndig lokal im Browser.<br>
Â© 2025 Potenzentrainer fÃ¼r den Mathematikunterricht
</p>

<script>
document.addEventListener("DOMContentLoaded",()=>{

// ========= Hilfsfunktionen =========
const VARS=['a','b','x','y'];
const randomChoice=a=>a[Math.floor(Math.random()*a.length)];
const randInt=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const superExp={1:"Â¹",2:"Â²",3:"Â³",4:"â´",5:"âµ",6:"â¶",7:"â·",8:"â¸",9:"â¹"};
const expToSup=e=>superExp[e]||"";
const normExp=s=>s.replace(/\s+/g,"").replace(/Â·/g,"*").replace(/:/g,"/").toLowerCase();
const removeTrailingZeros=str=>str.replace(/(\.\d*?[1-9])0+$/,"$1").replace(/\.0*$/,"");

// â€” sichere Umrechnung Mantisse * 10^exp â†’ Ganzzahl-String (ohne Floats)
function mantissaTimes10ToExpAsIntStr(mantissaStr, exp){
  const s = String(mantissaStr);
  const [i,f=""] = s.split(".");
  if (f.length > exp) return null;                 // zu viele Dezimalen
  const digits = i + f + "0".repeat(exp - f.length);
  // fÃ¼hrende Nullen entfernen, aber mindestens eine Ziffer lassen
  return digits.replace(/^0+(?=\d)/,"");
}

// ========= Eingabe-Buttons =========
function insertSymbol(target,symbol){
  const start=target.selectionStart??target.value.length;
  const end=target.selectionEnd??target.value.length;
  const text=target.value;
  target.value=text.slice(0,start)+symbol+text.slice(end);
  const pos=start+symbol.length;
  requestAnimationFrame(()=>{target.focus();target.selectionStart=target.selectionEnd=pos;});
}
function makeSupButtons(containerId,inputEl,includeMul=false){
  const cont=document.getElementById(containerId);
  for(let i=1;i<=9;i++){
    const btn=document.createElement("button");
    btn.textContent=superExp[i];
    btn.type="button";
    btn.onclick=()=>insertSymbol(inputEl,superExp[i]);
    cont.appendChild(btn);
  }
  if(includeMul){
    const mulBtn=document.createElement("button");
    mulBtn.textContent="Â·";
    mulBtn.type="button";
    mulBtn.onclick=()=>insertSymbol(inputEl,"Â·");
    cont.appendChild(mulBtn);
  }
}

// ========= Teil 1 (Potenzen) =========
const taskEl=document.getElementById("task");
const answerEl=document.getElementById("answer");
const checkBtn=document.getElementById("checkBtn");
const newBtn=document.getElementById("newBtn");
const resultEl=document.getElementById("result");
const scoreEl=document.getElementById("score");
makeSupButtons("supBtns1",answerEl,false);

let correctSolution="",round=1,score=0,totalRounds=10;

function createPowMultiply(){
  const base=randomChoice(VARS);
  const e1=randInt(1,5),e2=randInt(1,5);
  const res=e1+e2;if(res>9)return createPowMultiply();
  correctSolution=`${base}${expToSup(res)}`;
  const show1=e1===1?base:`${base}${expToSup(e1)}`;
  const show2=e2===1?base:`${base}${expToSup(e2)}`;
  return `${show1} Â· ${show2} = ?`;
}
function createPowDivide(){
  const base = randomChoice(VARS);
  const e1 = randInt(2, 9);
  const e2 = randInt(1, e1 - 1);
  const res = e1 - e2;
  if (res > 9) return createPowDivide();

  // Ergebnisformatierung:
  // res = 0 â†’ "1", res = 1 â†’ "a", sonst "aÂ²" etc.
  if (res === 0) correctSolution = "1";
  else if (res === 1) correctSolution = base;
  else correctSolution = `${base}${expToSup(res)}`;

  const show1 = e1 === 1 ? base : `${base}${expToSup(e1)}`;
  const show2 = e2 === 1 ? base : `${base}${expToSup(e2)}`;
  return `${show1} : ${show2} = ?`;
}

function createPowOfPow(){
  const base=randomChoice(VARS);
  const e1=randInt(1,4),e2=randInt(2,3);
  const res=e1*e2;if(res>9)return createPowOfPow();
  correctSolution=`${base}${expToSup(res)}`;
  // hier KEIN Weglassen von Â¹
  return `(${base}${expToSup(e1)})${expToSup(e2)} = ?`;
}
function newTask(){
  resultEl.innerText="";answerEl.value="";
  if(round>totalRounds){
    taskEl.innerText="ðŸŽ‰ Ãœbungsrunde fertig!";
    resultEl.style.color="green";
    resultEl.innerText=`Endstand: ${score}/${totalRounds} Punkte.`;
    newBtn.textContent="Neue Runde";round=1;score=0;return;
  }
  const r=Math.random();
  let aufgabe;
  if(r<0.4)aufgabe=createPowMultiply();
  else if(r<0.8)aufgabe=createPowDivide();
  else aufgabe=createPowOfPow();
  taskEl.innerText=aufgabe;
  scoreEl.innerText=`Aufgabe ${round} von ${totalRounds} â€“ Punkte: ${score}`;
}
function checkAnswer() {
  const input = answerEl.value.trim();
  if (!input) {
    resultEl.style.color = "gray";
    resultEl.innerText = "Bitte gib eine LÃ¶sung ein.";
    return;
  }

  const normIn = normExp(input);
  const normSol = normExp(correctSolution);

  // Entfernt nur ^1 bzw. Â¹ zur ToleranzprÃ¼fung
  const stripPow1 = s => s.replace(/\^1/g, "").replace(/Â¹/g, "");

  let equal = false;

  // ðŸ”¹ Wenn die richtige LÃ¶sung nur eine Variable ist (z. B. "a", "b", "x", "y"):
  // dann darf KEIN aÂ¹ als richtig gelten!
  if (VARS.includes(normSol)) {
    equal = (normIn === normSol); // nur exakter Treffer erlaubt
  } else {
    // ðŸ”¹ in allen anderen FÃ¤llen darf ^1 oder Â¹ weggelassen werden
    equal = (normIn === normSol) || (stripPow1(normIn) === stripPow1(normSol));
  }

  if (equal) {
    resultEl.style.color = "green";
    resultEl.innerText = "âœ… Richtig!";
    score++;
  } else {
    resultEl.style.color = "red";
    resultEl.innerText = `âŒ Falsch! Richtig: ${correctSolution}`;
  }

  round++;
  scoreEl.innerText = `Aufgabe ${Math.min(round, totalRounds)} von ${totalRounds} â€“ Punkte: ${score}`;
}


// â–¶ Event-Handler + erster Start (fehlten zuvor)
checkBtn.onclick=checkAnswer;
newBtn.onclick=newTask;
answerEl.onkeydown=e=>{if(e.key==="Enter")checkAnswer();};
newTask();

// ========= Teil 2 (Zehnerpotenzen & Gleitkomma) =========
const taskAdd=document.getElementById("taskAdd");
const resultAdd=document.getElementById("resultAdd");
const checkBtnAdd=document.getElementById("checkBtnAdd");
const newBtnAdd=document.getElementById("newBtnAdd");
const scoreAdd=document.getElementById("scoreAdd");
const answerAdd=document.getElementById("answerAdd");
makeSupButtons("supBtns2",answerAdd,true);

let correctAdd="",pointsAdd=0,roundAdd=1,totalAdd=10;
let toggleDir=false; // Richtung abwechselnd

function formatSci(mant,exp){
  const mStr=removeTrailingZeros(String(mant).replace('.',','));
  return `${mStr} Â· 10${superExp[exp]}`;
}

function createConversionTask() {
  const isPowerOnly = Math.random() < 0.33; // ca. 1/3 reine Zehnerpotenzen
  const dir = toggleDir ? "toSci" : "toNum"; // abwechselnde Richtung
  toggleDir = !toggleDir;
  const exp = randInt(3, 8); // Exponent 3â€“8 â†’ groÃŸe Zahlen mit mindestens zwei Nullen
  let mantissa;

  // ðŸ”¹ FÃ¼r reine Zehnerpotenzen: Mantisse 2â€“9
  if (isPowerOnly) {
    mantissa = randInt(2, 9);
  } else {
    // ðŸ”¹ FÃ¼r Gleitkommazahlen: 1â€“9 mit max 5 Nachkommastellen
    const totalDigits = randInt(2, 5); // insgesamt 2â€“5 Stellen (inkl. Nachkommastellen)
    let raw = (Math.random() * 9 + 1).toFixed(totalDigits - 1);
    mantissa = removeTrailingZeros(raw);
  }

  // ðŸ”¹ Gleitkommazahl darf nicht mehr Nachkommastellen haben als der Exponent
  if (!isPowerOnly) {
    const parts = mantissa.split(".");
    if (parts.length > 1 && parts[1].length > exp) {
      return createConversionTask(); // Neu versuchen
    }
  }

  // ðŸ”¹ Wert berechnen
  const value = mantissa * Math.pow(10, exp);

  // ðŸ”¹ Ergebnis muss ganzzahlig sein und auf mindestens zwei Nullen enden
  if (!Number.isInteger(value) || value % 100 !== 0) {
    return createConversionTask();
  }

  // ðŸ”¹ Nur sinnvolle Zahlen (> 100) zulassen
  if (value <= 100) return createConversionTask();

  // ðŸ”¹ Aufgabenrichtung bestimmen
  let aufgabe, lÃ¶sung;
  if (dir === "toSci") {
    // Zahl â†’ Potenzdarstellung
    aufgabe = value.toLocaleString("de-DE").replace(/\./g, ""); // ohne Tausenderpunkt
    lÃ¶sung = formatSci(mantissa, exp);
  } else {
    // Potenz â†’ Zahl
    aufgabe = formatSci(mantissa, exp);
    lÃ¶sung = value.toString();
  }

  correctAdd = lÃ¶sung;
  return aufgabe;
}


function normalizeNum(s){
  return s.replace(/\s/g,"").replace(/[.,]/g,"").toLowerCase();
}
function checkAdditionAnswer(){
  const input=answerAdd.value.trim();
  if(!input){resultAdd.style.color="gray";resultAdd.innerText="Bitte gib eine LÃ¶sung ein.";return;}
  const a=normExp(normalizeNum(input));
  const b=normExp(normalizeNum(correctAdd));
  if(a===b){ resultAdd.style.color="green";resultAdd.innerText="âœ… Richtig!";pointsAdd++; }
  else{ resultAdd.style.color="red";resultAdd.innerText=`âŒ Falsch! Richtig: ${correctAdd}`; }
  roundAdd++;
  scoreAdd.innerText=`Aufgabe ${Math.min(roundAdd,totalAdd)} von ${totalAdd} â€“ Punkte: ${pointsAdd}`;
}
function newAdditionTask(){
  resultAdd.innerText="";answerAdd.value="";
  if(roundAdd>totalAdd){
    taskAdd.innerText="ðŸŽ‰ Ãœbungsrunde fertig!";
    resultAdd.style.color="green";
    resultAdd.innerText=`Endstand: ${pointsAdd}/${totalAdd} Punkte.`;
    newBtnAdd.textContent="Neue Runde";roundAdd=1;pointsAdd=0;return;
  }
  const aufgabe=createConversionTask();
  taskAdd.innerText=aufgabe;
  scoreAdd.innerText=`Aufgabe ${roundAdd} von ${totalAdd} â€“ Punkte: ${pointsAdd}`;
}
checkBtnAdd.onclick=checkAdditionAnswer;
newBtnAdd.onclick=newAdditionTask;
answerAdd.onkeydown=e=>{if(e.key==="Enter")checkAdditionAnswer();};
newAdditionTask();

});
</script>
</body>
</html>
